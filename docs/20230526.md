# ソケットプログラミング

- ルータプログラムを作成する場合、TCP/IP モデルのネットワークインターフェイス層=Ethernet からパケットを扱いたいが、net パッケージでは 1 つ上のインターネットそうまでしか扱うことができない

| アプリケーション層             | HTTP          | net/http                 |
| --------------------------- | ------------- | ------------------------ |
| トランスポート層               | TC,UDP        | net.TCPConn, net.UDPConn |
| インターネット層               | IP, ICMP, ARP | net.IPConn               |
| ネットワークインターフェイス層 | Ethernet      | syscall                  |

- Linuxで通信プログラムを書く場合、socketを開いて取得したディスクリプタに対してread, writeを行う
- Goのnet packageがOSごとに異なるsocketの利用を抽象化してくれているので、普段はsocketを意識する必要がない

---
- ルータは複数のNWインターフェイスを扱う
    - NWインターフェイス名にMACアドレス、NWインターフェイスにbindするソケットのディスクリプタ番号などを持つ

---
- epoll
    - **poll**や**select**と同じように複数のファイルディスクリプタの入出力を監視してくれるシステムコール    
        - ソケットにパケットを受信したら教えてとカーネルに通知をお願いする
    - NWインターフェイスにbindしたソケットをepollの監視対象のディスクリプタとして登録している。
    - 監視するイベントはEPOLLINなので入力があったら通知してくれる
